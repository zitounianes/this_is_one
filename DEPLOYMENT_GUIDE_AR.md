# دليل نشر المشروع على Vercel مع قاعدة بيانات PostgreSQL

هذا الدليل يشرح خطوة بخطوة كيفية نشر المشروع على **Vercel** وربطه بقاعدة بيانات سحابية (PostgreSQL).

## 1. التجهيز الأولي (GitHub)
تأكد من أن الكود الخاص بك مرفوع على GitHub (كما هو الحال الآن).

## 2. إعداد قاعدة البيانات (Vercel Postgres أو Neon)
أسهل طريقة هي استخدام خدمة التخزين المدمجة في Vercel.

1. اذهب إلى [Vercel Dashboard](https://vercel.com/dashboard).
2. اضغط على **"Add New..."** ثم **"Project"** واختر هذا المستودع (Repo) من GitHub.
3. **لا تضغط Deploy بعد!**
4. بعد استيراد المشروع، اذهب للتعدادات (Settings) أو للصفحة الرئيسية للمشروع.
5. اذهب إلى تبويب **"Storage"** في الأعلى.
6. اضغط **"Create Database"** واختر **Postgres**.
7. اقبل الشروط واضغط **Create**.
8. بعد الإنشاء، سيظهر لك قسم **".env.local"**. اضغط على **"Show Secret"** وانسخ محتوى المتغيرات (خاصة `POSTGRES_PRISMA_URL` أو `DATABASE_URL`).

## 3. إعداد المتغيرات البيئية (Environment Variables)
في صفحة مشروعك على Vercel:
1. اذهب إلى **Settings > Environment Variables**.
2. أضف المتغير التالي:
   - **الاسم:** `DATABASE_URL`
   - **القيمة:** انسخ رابط الاتصال من الخطوة السابقة (يبدأ بـ `postgres://...`).
   *ملاحظة: إذا كنت تستخدم Vercel Storage، فغالباً ما يقوم Vercel بإضافة هذه المتغيرات تلقائياً عند ربط القاعدة.*

## 4. إعداد أمر البناء (Build Command)
Vercel يكتشف Next.js تلقائياً، لكن لتأكد من إعداد Prisma:
1. في إعدادات النشر (Deploy Settings).
2. تأكد أن **Build Command** هو: `next build` (الافتراضي).
3. تأكد أننا أضفنا سكريبت `postinstall` في `package.json` بقيمة `prisma generate`. (تم التأكد منه، الكود جاهز).

## 5. النشر (Deploy)
1. الآن اضغط **Deploy**.
2. سيقوم Vercel بتثبيت المكتبات، ثم تشغيل `prisma generate`، ثم بناء تطبيق Next.js.

## 6. تهيئة قاعدة البيانات (Migration)
بعد نجاح النشر، نحتاج لإنشاء الجداول في قاعدة البيانات السحابية:
1. في لوحة تحكم Vercel، اذهب إلى تبويب **Deployments**.
2. اضغط على الثلاث نقاط (More) بجانب آخر نشر ثم **Redeploy** (أحياناً نحتاج لهذا لضمان قراءة المتغيرات).
3. **الأهم:** لإنشاء الجداول، يمكنك تشغيل هذا الأمر من جهازك المحلي (إذا كان لديك Node.js):
   
   ```bash
   # أولاً: أنشئ ملف .env في جهازك وضع فيه DATABASE_URL الخاصة بـ Vercel
   npx prisma db push
   ```
   
   *هذا الأمر سيربط بجهازك بقاعدة بيانات Vercel وينشئ الجداول هناك.*

## 7. التأكد من العمل
- افتح رابط الموقع الذي يعطيك إياه Vercel.
- ستلاحظ أن البيانات فارغة (لأن القاعدة جديدة).
- اذهب لصفحة `/admin.html` واستخدم كلمة المرور الافتراضية `admin123`.
- أضف أقساماً ووجبات جديدة.
- البيانات الآن تُحفظ في السحابة وليس في متصفحك!

---

### ملاحظة حول ملفات `public/` HTML
بما أنك تستخدم ملفات HTML ثابتة في `public/`، فقد قمت بتعديل `js/data.js` ليتحدث مع `api/` بدلاً من LocalStorage. تأكد من أن الروابط تعمل. إذا واجهت مشاكل في الروابط، تأكد أنك لا تستخدم `index.html` في الرابط بل جذر الموقع `/`، أو أن Vercel يخدم الملفات الثابتة بشكل صحيح (وهو الافتراضي).
